<!DOCTYPE html>
<html lang="en">
<title>Network Optimization Case Study: Aiding Allies | Algebra, Geometry and Applications of Optimization</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Ayush Bharadwaj">
<meta name="generator" content="Jekyll v4.2.2">
<link rel="canonical" href="http://localhost:4000/network-optimization-case-study/">

<link rel="stylesheet" href="/assets/css/frame.css">

<link rel="alternate" href="/feed.xml" type="application/atom+xml" title="Algebra, Geometry and Applications of Optimization">


<link rel="stylesheet" href="/assets/katex/katex.min.css">
<script defer src="/assets/katex/katex.min.js"></script>
<script defer src="/assets/katex/contrib/auto-render.min.js" onload="renderMathInElement(document.body)"></script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>




<link rel="stylesheet" href="/assets/css/sidebar.css" media="screen and (min-width: 70em)">
<aside style="display: none">
  <nav><a aria-label="Home" href="/" >
      <svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#"></use></svg>
      <span aria-hidden="true">Home</span>
    </a><a aria-label="About" href="/about" >
      <svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#"></use></svg>
      <span aria-hidden="true">About</span>
    </a><a aria-label="Projects" href="/projects" >
      <svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#"></use></svg>
      <span aria-hidden="true">Projects</span>
    </a><a aria-label="Resume" href="/assets/files/ayush_resume_v11.pdf" >
      <svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#"></use></svg>
      <span aria-hidden="true">Resume</span>
    </a><a aria-label="Mail" href="mailto:ayush.bharadwaj@gmail.com" >
      <svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#envelope"></use></svg>
      <span aria-hidden="true">Mail</span>
    </a><a aria-label="Github" href="https://github.com/ayusbhar2" >
      <svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#github"></use></svg>
      <span aria-hidden="true">Github</span>
    </a><a aria-label="LinkedIn" href="https://www.linkedin.com/in/ayushbharadwaj/" >
      <svg aria-hidden="true" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#linkedin"></use></svg>
      <span aria-hidden="true">LinkedIn</span>
    </a></nav>
  <div class="description">Algebra, Geometry and Applications of Optimization</div>
</aside>




<header>
  <a href="/" class="title">Algebra, Geometry and Applications of Optimization</a>
  <nav><a href="/" >Home</a><a href="/about" >About</a><a href="/projects" >Projects</a><a href="/assets/files/ayush_resume_v11.pdf" >Resume</a></nav>

</header>

<article>
  <header>
  <h1><a href="/network-optimization-case-study/">Network Optimization Case Study: Aiding Allies</a></h1><time datetime="2023-06-05T00:00:00-07:00">June 05, 2023</time>
</header>

  <p>[Source: Frederick S. Hillier and Gerald J. Lieberman.  <em>Introduction to Operations Research - 7th ed.</em>, 2000, McGraw-Hill, ISBN 0-07-232169-5]</p>

<p>A rebel army is attempting to overthrow the elected government of the Russian Federation. The United States government has decided to assist its ally by quickly sending troops and supplies to the Federation. A plan needs to be developed for shipping the troops and supplies most effectively. Depending on the overall measure of performance, the analysis requires formulating and solving a shortest-path problem, a minimum cost flow problem, or a maximum flow problem.</p>

<hr />
<p>Commander Votachev steps into the cold October night and deeply inhales the smoke from his cigarette, savoring its warmth. He surveys the destruction surrounding him — shattered windows, burning buildings, torn roads — and smiles. His two years of work training revolutionaries east of the Ural Mountains has proved successful; his troops now occupy seven strategically important cities in the Russian Federation: Kazan, Perm,Yekaterinburg, Ufa, Samara, Saratov, and Orenburg. His siege is not yet over, however. He looks to the west. Given the political and economic confusion in the Russian Federation at this time, he knows that his troops will be able to conquer Saint Petersburg and Moscow shortly. Commander Votachev will then be able to rule with the wisdom and control exhibited by his communist predecessors Lenin and Stalin.</p>

<p>Across the Pacific Ocean, a meeting of the top security and foreign policy advisers of the United States is in progress at the White House. The President has recently been briefed about the communist revolution masterminded by Commander Votachev and is determining a plan of action. The President reflects upon a similar October long ago in 1917, and he fears the possibility of a new age of radical Communist rule accompanied by chaos, bloodshed, escalating tensions, and possibly nuclear war. He therefore decides that the United States needs to respond and to respond quickly. Moscow has requested assistance from the United States military, and the President plans to send troops and supplies immediately.</p>

<p>The President turns to General Lankletter and asks him to describe the preparations being taken in the United States to send the necessary troops and supplies to the Russian Federation. General Lankletter informs the President that along with troops, weapons, ammunition, fuel, and supplies, aircraft, ships, and vehicles are being assembled at two port cities with airfields: Boston and Jacksonville. The aircraft and ships will transfer all troops and cargo across the Atlantic Ocean to the Eurasian continent. The general hands the President a list of the types of aircraft, ships, and vehicles being assembled along with a description of each type. The list is shown below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Transportation Type</th>
      <th style="text-align: left">Name</th>
      <th style="text-align: left">Capacity</th>
      <th style="text-align: left">Speed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Aircraft</td>
      <td style="text-align: left">C-141 Starlifter</td>
      <td style="text-align: left">150 tons</td>
      <td style="text-align: left">400 miles per hour</td>
    </tr>
    <tr>
      <td style="text-align: left">Ship</td>
      <td style="text-align: left">Transport</td>
      <td style="text-align: left">240 tons</td>
      <td style="text-align: left">35 miles per hour</td>
    </tr>
    <tr>
      <td style="text-align: left">Vehicle</td>
      <td style="text-align: left">Palletized Load System Truck</td>
      <td style="text-align: left">16,000 kilograms</td>
      <td style="text-align: left">60 miles per hour</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>All aircraft, ships, and vehicles are able to carry both troops and cargo.</li>
  <li>Once an aircraft or ship arrives in Europe, it stays there to support the armed forces.</li>
</ul>

<p>The President then turns to Tabitha Neal, who has been negotiating with the NATO countries for the last several hours to use their ports and airfields as stops to refuel and resupply before heading to the Russian Federation. She informs the President that the following ports and airfields in the NATO countries will be made available to the United States military.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Ports</th>
      <th style="text-align: left">Airfields</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">London</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Berlin</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Istanbul</td>
    </tr>
  </tbody>
</table>

<p>The President stands and walks to the map of the world projected on a large screen in the middle of the room. He maps the progress of troops and cargo from the United States to three strategic cities in the Russian Federation that have not yet been seized by Commander Votachev. The three cities are Saint Petersburg, Moscow, and Rostov. He explains that the troops and cargo will be used both to defend the Russian cities and to launch a counterattack against Votachev to recapture the cities he currently occupies. The President also explains that:</p>

<ul>
  <li>All Starlifters and transports leave either Boston or Jacksonville.</li>
  <li>All transports that have traveled across the Atlantic must dock at one of the NATO ports to unload.</li>
  <li>Palletized load system trucks brought over in the transports will then carry all troops and materials unloaded from the ships at the NATO ports to the three strategic Russian cities not yet seized by Votachev - Saint Petersburg, Moscow, and Rostov.</li>
  <li>All Starlifters that have traveled across the Atlantic must land at one of the NATO airfields for refueling. The planes will then carry all troops and cargo from the NATO airfields to the three Russian cities.</li>
</ul>

<p><img src="../assets/files/images/aiding_allies_map.png" width="900" align="center" /></p>

<p>The different routes that may be taken by the troops and supplies to reach the Russian Federation from the United States are shown below:</p>

<p><img src="../assets/files/images/possible_routes_new.png" width="500" length="500" align="center" /></p>

<h2 id="scenario-1-when-time-is-of-the-essence">Scenario 1: When time is of the essence</h2>
<h3 id="the-shortest-path-problem">The shortest path problem</h3>
<p>Moscow and Washington do not know when Commander Votachev will launch his next attack. Leaders from the two countries have therefore agreed that troops should reach each of the three strategic Russian cities as quickly as possible.</p>

<p>The President has determined that the situation is so dire that cost is no object—as many Starlifters, transports, and trucks as are necessary will be used to transfer troops and cargo from the United States to Saint Petersburg, Moscow, and Rostov. Therefore,no limitations exist on the number of troops and amount of cargo that can be transferred between any cities.</p>

<p>The President has been given the following information about the length of the available routes between cities on the Atlantic leg:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">From</th>
      <th style="text-align: left">To</th>
      <th style="text-align: center">Length of route (km)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: center">7,250</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: center">8,250</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: center">8,300</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">London</td>
      <td style="text-align: center">6,200</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: center">6,900</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: center">7,950</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: center">9,200</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: center">9,800</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: center">10,100</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">London</td>
      <td style="text-align: center">7,900</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: center">8,900</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: center">9,400</td>
    </tr>
  </tbody>
</table>

<p>and on the Eurasian leg:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">From</th>
      <th style="text-align: left">To</th>
      <th style="text-align: center">Length of route (km)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: center">1,280</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: center">1,880</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: center">2,040</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: center">1,980</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: center">2,200</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: center">2,970</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: center">1,600</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: center">2,120</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: center">1,700</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: center">2,300</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: center">2,450</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: center">2,890</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: center">1,730</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: center">2,470</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: center">990</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: center">2,860</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: center">2,760</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: center">2,800</td>
    </tr>
  </tbody>
</table>

<p>Given the distance and the speed of the transportation used between each pair of cities, how can the President most quickly move troops from the United States to each of the three strategic Russian cities?</p>

<h3 id="dijkstras-shortest-path-model">Dijkstra’s shortest path model</h3>
<p>Since Question 1 is only concerned with the minimum time taken by the troops to reach Russia, we can model this problem as a <em>shortest path problem</em> with each edge length representing the time taken to travel from the source node to the target node. The problem can then be solved using <em>Dijkstra’s shortest path algorithm</em>. We will use the helper classes and methods provided by the custom <a href="https://github.com/ayusbhar2/operations_research/tree/main/solver">solver</a> module to solve the problem.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># my solver module
</span><span class="kn">from</span> <span class="nn">solver.algorithms</span> <span class="kn">import</span> <span class="n">get_shortest_path</span>
<span class="kn">from</span> <span class="nn">solver.classes</span> <span class="kn">import</span> <span class="n">Edge</span><span class="p">,</span> <span class="n">Graph</span>
<span class="kn">from</span> <span class="nn">solver.utils</span> <span class="kn">import</span> <span class="n">get_result_summary</span><span class="p">,</span> <span class="n">get_variable</span><span class="p">,</span> <span class="n">prettify</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="n">AIR_SPEED_KMPH</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="mf">1.60934</span>  <span class="c1"># from MPH to KMPH
</span><span class="n">WATER_SPEED_KMPH</span> <span class="o">=</span> <span class="mi">35</span> <span class="o">*</span> <span class="mf">1.60934</span>
<span class="n">LAND_SPEED_KMPH</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mf">1.60934</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create the network graph with provided edges
</span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">([</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Berlin'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">7250</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Hamburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">8250</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'sea'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Istanbul'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">8300</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'London'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">6200</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Rotterdam'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">6900</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'sea'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Napoli'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">7950</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'sea'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Berlin'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">9200</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Hamburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">9800</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'sea'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Istanbul'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">10100</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'London'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">7900</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Rotterdam'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">8900</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'sea'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Napoli'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">9400</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'sea'</span><span class="p">),</span>
    
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">1280</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">1880</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2040</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">1980</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2200</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2970</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">1600</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2120</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">1700</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2300</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2450</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2890</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">1730</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2470</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">990</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2860</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'air'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2760</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">,</span> <span class="n">distance_km</span><span class="o">=</span><span class="mi">2800</span><span class="p">,</span> <span class="n">route_type</span><span class="o">=</span><span class="s">'land'</span><span class="p">),</span>
<span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Update all edges with a non-negative time-cost
</span><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">edge</span><span class="p">.</span><span class="n">route_type</span> <span class="o">==</span> <span class="s">'air'</span><span class="p">:</span>
        <span class="n">time_hr</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">distance_km</span> <span class="o">/</span> <span class="n">AIR_SPEED_KMPH</span>
    <span class="k">elif</span> <span class="n">edge</span><span class="p">.</span><span class="n">route_type</span> <span class="o">==</span> <span class="s">'sea'</span><span class="p">:</span>
        <span class="n">time_hr</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">distance_km</span> <span class="o">/</span> <span class="n">WATER_SPEED_KMPH</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">time_hr</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">distance_km</span> <span class="o">/</span> <span class="n">LAND_SPEED_KMPH</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="n">time_hr</span><span class="p">)</span> <span class="c1"># edge cost is needed for shortest path algorithm
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s">'Jacksonville'</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'dijkstra'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(15.347906595250226, ['Jacksonville', 'London', 'StPetersburg'])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s">'Boston'</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s">'StPetersburg'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'dijkstra'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(12.707072464488547, ['Boston', 'London', 'StPetersburg'])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s">'Jacksonville'</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s">'Moscow'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'dijkstra'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(15.845004784570072, ['Jacksonville', 'London', 'Moscow'])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s">'Boston'</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s">'Moscow'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'dijkstra'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(13.204170653808394, ['Boston', 'London', 'Moscow'])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s">'Jacksonville'</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s">'Rostov'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'dijkstra'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(16.7149266158798, ['Jacksonville', 'London', 'Rostov'])
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s">'Boston'</span><span class="p">,</span> <span class="n">target_name</span><span class="o">=</span><span class="s">'Rostov'</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s">'dijkstra'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(13.949817937788161, ['Boston', 'Berlin', 'Rostov'])
</code></pre></div></div>

<p>From the above results we see that the fastest way to get troops and supplies to each of the three strategic Russian cities is:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Boston --&gt; London --&gt; Saint Petersburg (12.70 hr)</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Boston --&gt; London --&gt; Moscow (13.20 hr)</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Boston --&gt; Berlin --&gt; Rostov (13.95 hr)</code></p>
  </li>
</ul>

<h3 id="the-binary-integer-programming-model">The Binary Integer Programming model</h3>

<p>We can also model the above problem as a binary integer program as follows.</p>

<p>Parameters:</p>

\[c_{j, k} := \text{ the "cost" associated with edge } (j, k)\]

<p>Variables:</p>

\[x_i:= \begin{cases}
1 \text{ if node i is on the path}\\
0 \text{ otherwise}
\end{cases}\]

\[y_{j, k}:= \begin{cases}
1 \text{ if edge (j, k) is on the path}\\
0 \text{ otherwise}
\end{cases}\]

<p>Objective:</p>

\[\text{minimize} \sum_{j, k} y_{j, k} c_{j, k}\]

<p>Constraints:</p>

\[x_O := 1 \qquad\text{(Origin constraint)}\]

\[x_T := 1  \qquad\text{(Target constraint)}\]

\[\sum_{j} y_{j, i} \le 1 + M (1 - x_i)\ , \quad i \ne O \quad \text{(Inbound constraint 1)}\\
\sum_{j} y_{j, i} \ge 1 - M (1 - x_i)\ , \quad i \ne O \quad \text{(Inbound constraint 2)}\]

\[\sum_{k} y_{i, k} \le 1 + M (1 - x_i)\ , \quad i \ne T \quad \text{(Outbound constraint 1)}\\
\sum_{k} y_{i, k} \ge 1 - M(1 - x_i)\ , \quad i \ne T \quad \text{(Outbound constraint 2)}\]

\[x_j + x_k \ge 2 y_{j, k} \quad \forall\ j, k \quad \text{(Connectivity constraint)}\]

\[x_i , y_{j, k} \quad \text{binary}\]

<p>In order to understand how this formulation would work, let us consider the subgraph with a single source node, viz. Boston, and a single target node, viz. St. Petersburg.</p>

<p><img src="../assets/files/images/bip_formulation.png" width="500" /></p>

<p>Lets solve the above program with <code class="language-plaintext highlighter-rouge">cvxpy</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cvxpy</span> <span class="k">as</span> <span class="n">cp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="c1"># my custom solver module
</span><span class="kn">from</span> <span class="nn">solver.classes</span> <span class="kn">import</span> <span class="n">BinaryIntegerProblem</span>
<span class="kn">from</span> <span class="nn">solver.algorithms</span> <span class="kn">import</span> <span class="n">branch_and_bound</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#define function for conditional formatting
</span><span class="k">def</span> <span class="nf">cond_formatting</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'background-color: lightgray'</span>
    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_outbound_constraints</span><span class="p">(</span><span class="n">vertex_name</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">'('</span>
    <span class="n">t</span> <span class="o">=</span> <span class="s">'('</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="n">vertex_name</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">'y_{}_{} + '</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="s">'y_{}_{} + '</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">') &lt;= 1 + M * (1 - x_{})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">vertex_name</span><span class="p">)</span>
    
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="s">') &gt;= 1 - M * (1 - x_{})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">vertex_name</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_inbound_constraints</span><span class="p">(</span><span class="n">vertex_name</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">'('</span>
    <span class="n">t</span> <span class="o">=</span> <span class="s">'('</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">target_name</span><span class="o">=</span><span class="n">vertex_name</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">'y_{}_{} + '</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">+=</span> <span class="s">'y_{}_{} + '</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">') &lt;= 1 + M * (1 - x_{})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">vertex_name</span><span class="p">)</span>
    
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="s">') &gt;= 1 - M * (1 - x_{})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">vertex_name</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_connectivity_constraints</span><span class="p">(</span><span class="n">edge</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s">'x_{s} + x_{t} &gt;= 2 * y_{s}_{t}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>    
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Parameters
</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'c_{s}_{t} = edge.cost'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Variables
</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'y_{s}_{t} = cp.Variable(1, boolean=True, name="y_{s}_{t}")'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'variables.append(y_{s}_{t})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>

<span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">vertices</span><span class="p">:</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'x_{v} = cp.Variable(1, boolean=True, name="x_{v}")'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">vertex</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'variables.append(x_{v})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">vertex</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Constraints
</span>
<span class="n">constraints_bip</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># origin and destination constraints
</span>    <span class="n">x_Boston</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">x_Jacksonville</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">x_StPetersburg</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">x_Moscow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">x_Rostov</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># inbound and outbound constraints
</span><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">vertices</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">'Boston'</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">'Jacksonville'</span><span class="p">:</span>  <span class="c1"># not a source node
</span>        <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">get_inbound_constraints</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
        <span class="n">constraints_bip</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">constraints_bip</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">'StPetersburg'</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">'Moscow'</span> <span class="ow">and</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">'Rostov'</span><span class="p">:</span>  <span class="c1"># not a target node
</span>        <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">get_outbound_constraints</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
        <span class="n">constraints_bip</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">constraints_bip</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="c1"># connectivity constraints
</span><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">get_connectivity_constraints</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="n">constraints_bip</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Objective
</span>
<span class="n">obj_str</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">obj_str</span> <span class="o">+=</span> <span class="s">'c_{s}_{t} * y_{s}_{t} + '</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">obj_str</span> <span class="o">=</span> <span class="n">obj_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

<span class="n">objective_bip</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">Minimize</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">obj_str</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Model
</span>
<span class="n">bip</span> <span class="o">=</span> <span class="n">BinaryIntegerProblem</span><span class="p">(</span><span class="n">objective_bip</span><span class="p">,</span> <span class="n">constraints_bip</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bip</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===============================================================================
                                     CVXPY                                     
                                     v1.3.1                                    
===============================================================================
(CVXPY) Jun 07 07:08:40 PM: Your problem has 41 variables, 69 constraints, and 0 parameters.
(CVXPY) Jun 07 07:08:40 PM: It is compliant with the following grammars: DCP, DQCP
(CVXPY) Jun 07 07:08:40 PM: (If you need to solve this problem multiple times, but with different data, consider using parameters.)
(CVXPY) Jun 07 07:08:40 PM: CVXPY will first compile your problem; then, it will invoke a numerical solver to obtain a solution.
-------------------------------------------------------------------------------
                                  Compilation                                  
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:40 PM: Compiling problem (target solver=GLPK_MI).
(CVXPY) Jun 07 07:08:40 PM: Reduction chain: Dcp2Cone -&gt; CvxAttr2Constr -&gt; ConeMatrixStuffing -&gt; GLPK_MI
(CVXPY) Jun 07 07:08:40 PM: Applying reduction Dcp2Cone
(CVXPY) Jun 07 07:08:40 PM: Applying reduction CvxAttr2Constr
(CVXPY) Jun 07 07:08:40 PM: Applying reduction ConeMatrixStuffing
(CVXPY) Jun 07 07:08:40 PM: Applying reduction GLPK_MI
(CVXPY) Jun 07 07:08:40 PM: Finished problem compilation (took 1.239e-01 seconds).
-------------------------------------------------------------------------------
                                Numerical solver                               
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:40 PM: Invoking solver GLPK_MI  to obtain a solution.
-------------------------------------------------------------------------------
                                    Summary                                    
-------------------------------------------------------------------------------      0: obj =   0.000000000e+00 inf =   2.000e+00 (2)
      7: obj =   1.270707246e+01 inf =   0.000e+00 (0)
*    15: obj =   1.270707246e+01 inf =   0.000e+00 (0)
+    15: mip =     not found yet &gt;=              -inf        (1; 0)
+    15: &gt;&gt;&gt;&gt;&gt;   1.270707246e+01 &gt;=   1.270707246e+01   0.0% (1; 0)
+    15: mip =   1.270707246e+01 &gt;=     tree is empty   0.0% (0; 1)

(CVXPY) Jun 07 07:08:40 PM: Problem status: optimal
(CVXPY) Jun 07 07:08:40 PM: Optimal value: 1.271e+01
(CVXPY) Jun 07 07:08:40 PM: Compilation took 1.239e-01 seconds
(CVXPY) Jun 07 07:08:40 PM: Solver (including time spent in interface) took 8.249e-04 seconds
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span> <span class="o">=</span> <span class="n">get_result_summary</span><span class="p">(</span><span class="n">bip</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'optimal'
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">[</span><span class="s">'optimal_value'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>12.707072464488547
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">prettify</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s">'optimal_solution'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">cond_formatting</span><span class="p">)</span>
</code></pre></div></div>

<style type="text/css">
#T_f391d_row1_col1, #T_f391d_row5_col1, #T_f391d_row10_col1, #T_f391d_row17_col1, #T_f391d_row34_col1 {
  background-color: lightgray;
}
</style>

<table id="T_f391d_">
  <thead>
    <tr>
      <th class="blank level0">&nbsp;</th>
      <th class="col_heading level0 col0">variable</th>
      <th class="col_heading level0 col1">value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_f391d_level0_row0" class="row_heading level0 row0">0</th>
      <td id="T_f391d_row0_col0" class="data row0 col0">x_Berlin</td>
      <td id="T_f391d_row0_col1" class="data row0 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row1" class="row_heading level0 row1">1</th>
      <td id="T_f391d_row1_col0" class="data row1 col0">x_Boston</td>
      <td id="T_f391d_row1_col1" class="data row1 col1">1.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row2" class="row_heading level0 row2">2</th>
      <td id="T_f391d_row2_col0" class="data row2 col0">x_Hamburg</td>
      <td id="T_f391d_row2_col1" class="data row2 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row3" class="row_heading level0 row3">3</th>
      <td id="T_f391d_row3_col0" class="data row3 col0">x_Istanbul</td>
      <td id="T_f391d_row3_col1" class="data row3 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row4" class="row_heading level0 row4">4</th>
      <td id="T_f391d_row4_col0" class="data row4 col0">x_Jacksonville</td>
      <td id="T_f391d_row4_col1" class="data row4 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row5" class="row_heading level0 row5">5</th>
      <td id="T_f391d_row5_col0" class="data row5 col0">x_London</td>
      <td id="T_f391d_row5_col1" class="data row5 col1">1.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row6" class="row_heading level0 row6">6</th>
      <td id="T_f391d_row6_col0" class="data row6 col0">x_Moscow</td>
      <td id="T_f391d_row6_col1" class="data row6 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row7" class="row_heading level0 row7">7</th>
      <td id="T_f391d_row7_col0" class="data row7 col0">x_Napoli</td>
      <td id="T_f391d_row7_col1" class="data row7 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row8" class="row_heading level0 row8">8</th>
      <td id="T_f391d_row8_col0" class="data row8 col0">x_Rostov</td>
      <td id="T_f391d_row8_col1" class="data row8 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row9" class="row_heading level0 row9">9</th>
      <td id="T_f391d_row9_col0" class="data row9 col0">x_Rotterdam</td>
      <td id="T_f391d_row9_col1" class="data row9 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row10" class="row_heading level0 row10">10</th>
      <td id="T_f391d_row10_col0" class="data row10 col0">x_StPetersburg</td>
      <td id="T_f391d_row10_col1" class="data row10 col1">1.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row11" class="row_heading level0 row11">11</th>
      <td id="T_f391d_row11_col0" class="data row11 col0">y_Berlin_Moscow</td>
      <td id="T_f391d_row11_col1" class="data row11 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row12" class="row_heading level0 row12">12</th>
      <td id="T_f391d_row12_col0" class="data row12 col0">y_Berlin_Rostov</td>
      <td id="T_f391d_row12_col1" class="data row12 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row13" class="row_heading level0 row13">13</th>
      <td id="T_f391d_row13_col0" class="data row13 col0">y_Berlin_StPetersburg</td>
      <td id="T_f391d_row13_col1" class="data row13 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row14" class="row_heading level0 row14">14</th>
      <td id="T_f391d_row14_col0" class="data row14 col0">y_Boston_Berlin</td>
      <td id="T_f391d_row14_col1" class="data row14 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row15" class="row_heading level0 row15">15</th>
      <td id="T_f391d_row15_col0" class="data row15 col0">y_Boston_Hamburg</td>
      <td id="T_f391d_row15_col1" class="data row15 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row16" class="row_heading level0 row16">16</th>
      <td id="T_f391d_row16_col0" class="data row16 col0">y_Boston_Istanbul</td>
      <td id="T_f391d_row16_col1" class="data row16 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row17" class="row_heading level0 row17">17</th>
      <td id="T_f391d_row17_col0" class="data row17 col0">y_Boston_London</td>
      <td id="T_f391d_row17_col1" class="data row17 col1">1.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row18" class="row_heading level0 row18">18</th>
      <td id="T_f391d_row18_col0" class="data row18 col0">y_Boston_Napoli</td>
      <td id="T_f391d_row18_col1" class="data row18 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row19" class="row_heading level0 row19">19</th>
      <td id="T_f391d_row19_col0" class="data row19 col0">y_Boston_Rotterdam</td>
      <td id="T_f391d_row19_col1" class="data row19 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row20" class="row_heading level0 row20">20</th>
      <td id="T_f391d_row20_col0" class="data row20 col0">y_Hamburg_Moscow</td>
      <td id="T_f391d_row20_col1" class="data row20 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row21" class="row_heading level0 row21">21</th>
      <td id="T_f391d_row21_col0" class="data row21 col0">y_Hamburg_Rostov</td>
      <td id="T_f391d_row21_col1" class="data row21 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row22" class="row_heading level0 row22">22</th>
      <td id="T_f391d_row22_col0" class="data row22 col0">y_Hamburg_StPetersburg</td>
      <td id="T_f391d_row22_col1" class="data row22 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row23" class="row_heading level0 row23">23</th>
      <td id="T_f391d_row23_col0" class="data row23 col0">y_Istanbul_Moscow</td>
      <td id="T_f391d_row23_col1" class="data row23 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row24" class="row_heading level0 row24">24</th>
      <td id="T_f391d_row24_col0" class="data row24 col0">y_Istanbul_Rostov</td>
      <td id="T_f391d_row24_col1" class="data row24 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row25" class="row_heading level0 row25">25</th>
      <td id="T_f391d_row25_col0" class="data row25 col0">y_Istanbul_StPetersburg</td>
      <td id="T_f391d_row25_col1" class="data row25 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row26" class="row_heading level0 row26">26</th>
      <td id="T_f391d_row26_col0" class="data row26 col0">y_Jacksonville_Berlin</td>
      <td id="T_f391d_row26_col1" class="data row26 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row27" class="row_heading level0 row27">27</th>
      <td id="T_f391d_row27_col0" class="data row27 col0">y_Jacksonville_Hamburg</td>
      <td id="T_f391d_row27_col1" class="data row27 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row28" class="row_heading level0 row28">28</th>
      <td id="T_f391d_row28_col0" class="data row28 col0">y_Jacksonville_Istanbul</td>
      <td id="T_f391d_row28_col1" class="data row28 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row29" class="row_heading level0 row29">29</th>
      <td id="T_f391d_row29_col0" class="data row29 col0">y_Jacksonville_London</td>
      <td id="T_f391d_row29_col1" class="data row29 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row30" class="row_heading level0 row30">30</th>
      <td id="T_f391d_row30_col0" class="data row30 col0">y_Jacksonville_Napoli</td>
      <td id="T_f391d_row30_col1" class="data row30 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row31" class="row_heading level0 row31">31</th>
      <td id="T_f391d_row31_col0" class="data row31 col0">y_Jacksonville_Rotterdam</td>
      <td id="T_f391d_row31_col1" class="data row31 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row32" class="row_heading level0 row32">32</th>
      <td id="T_f391d_row32_col0" class="data row32 col0">y_London_Moscow</td>
      <td id="T_f391d_row32_col1" class="data row32 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row33" class="row_heading level0 row33">33</th>
      <td id="T_f391d_row33_col0" class="data row33 col0">y_London_Rostov</td>
      <td id="T_f391d_row33_col1" class="data row33 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row34" class="row_heading level0 row34">34</th>
      <td id="T_f391d_row34_col0" class="data row34 col0">y_London_StPetersburg</td>
      <td id="T_f391d_row34_col1" class="data row34 col1">1.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row35" class="row_heading level0 row35">35</th>
      <td id="T_f391d_row35_col0" class="data row35 col0">y_Napoli_Moscow</td>
      <td id="T_f391d_row35_col1" class="data row35 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row36" class="row_heading level0 row36">36</th>
      <td id="T_f391d_row36_col0" class="data row36 col0">y_Napoli_Rostov</td>
      <td id="T_f391d_row36_col1" class="data row36 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row37" class="row_heading level0 row37">37</th>
      <td id="T_f391d_row37_col0" class="data row37 col0">y_Napoli_StPetersburg</td>
      <td id="T_f391d_row37_col1" class="data row37 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row38" class="row_heading level0 row38">38</th>
      <td id="T_f391d_row38_col0" class="data row38 col0">y_Rotterdam_Moscow</td>
      <td id="T_f391d_row38_col1" class="data row38 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row39" class="row_heading level0 row39">39</th>
      <td id="T_f391d_row39_col0" class="data row39 col0">y_Rotterdam_Rostov</td>
      <td id="T_f391d_row39_col1" class="data row39 col1">0.000000</td>
    </tr>
    <tr>
      <th id="T_f391d_level0_row40" class="row_heading level0 row40">40</th>
      <td id="T_f391d_row40_col0" class="data row40 col0">y_Rotterdam_StPetersburg</td>
      <td id="T_f391d_row40_col1" class="data row40 col1">0.000000</td>
    </tr>
  </tbody>
</table>

<p>The above result confirms what we already knew from the previous section - the fastest path from Boston to StPetersburg is <code class="language-plaintext highlighter-rouge">Boston --&gt; London --&gt; Saint Petersburg (12.70 hr)</code>. We can solve similar fomulations for each source-target pair to get the desired results.</p>

<p>It should not come as a surprise that the above problem could be modeled both as a BIP and a Dijkstra’s shortest path problem. In fact both these problems are solved using an algorithm that falls into the <strong>Dynamic Programming</strong> paradigm.</p>

<p>It is worth noting that most BIP solvers use some variation of the Branch and Bound algorithm which recursively solves repeated LP relaxations of the original BIP with the simplex method. Since the simplex algorithm is a polynomial time algorithm, the average total running time for the original BIP is close to polynomial in the size of the problem (i.e. number of variables). Let \(N: =\)number of vertices and \(M:=\) number of edges in the graph. Then, from the above formulation, we note that the total number of variables is \(M + N\). The average running time of the Branch and Bound algorithm is given by \(O(M + N)^p\), \(p &gt; 1\). On the other hand, Dijkstra’s shortest path algorithm has a running time of \(O(MN)\).</p>

<p>However, while the BIP formulation only works for a single source-destination pair at a time, Dijkstra’s algorithm can return the shortest path from a source node to <em>all</em> the other nodes in a single run. Hence, for larger problems, it may be advantageous to use Dijkstra’s algortihm instead of a BIP formulation.</p>

<h2 id="scenario-2-when-money-is-an-object">Scenario 2: When money <em>is</em> an object</h2>
<h3 id="a-minimum-cost-flow-problem">A minimum cost flow problem</h3>

<p>The President encounters only one problem with his first plan: he has to sell the military deployment to Congress. Under the War Powers Act, the President is required to consult with Congress before introducing troops into hostilities or situations where hostilities will occur. If Congress does not give authorization to the President for such use of troops, the President must withdraw troops after 60 days. Congress also has the power to decrease the 60-day time period by passing a concurrent resolution.</p>

<p>The President knows that Congress will not authorize significant spending for another country’s war, especially when voters have paid so much attention to decreasing the national debt. He therefore decides that he needs to find a way to get the needed troops and supplies to Saint Petersburg, Moscow, and Rostov at the minimum cost.</p>

<p>Each Russian city has contacted Washington to communicate the number of troops and supplies the city needs at a minimum for reinforcement. After analyzing the requests, General Lankletter has converted the requests from numbers of troops, gallons of gasoline, etc., to tons of cargo for easier planning. The requirements are listed below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">City</th>
      <th style="text-align: left">Requirements</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">320,000 tons</td>
    </tr>
    <tr>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">440,000 tons</td>
    </tr>
    <tr>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">240,000 tons</td>
    </tr>
  </tbody>
</table>

<p>Both in Boston and Jacksonville there are 500,000 tons of the necessary cargo available. When the United States decides to send a plane, ship, or truck between two cities, several costs occur—fuel costs, labor costs, maintenance costs, and appropriate port or airfield taxes and tariffs. These costs are listed below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">From</th>
      <th style="text-align: left">To</th>
      <th style="text-align: left">Cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">$50,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">$30,000 per transport</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">$55,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">London</td>
      <td style="text-align: left">$45,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">$30,000 per transport</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">$32,000 per transport</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">$57,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">$48,000 per transport</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">$61,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">London</td>
      <td style="text-align: left">$49,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">$44,000 per transport</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">$56,000 per transport</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">$24,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">$3,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">$28,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">$22,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">$3,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">$ 5,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">$22,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">$ 4,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">$25,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">$19,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">$ 5,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">$ 5,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">$23,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">$ 7,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">$ 2,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">$ 4,000 per Starlifter</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">$ 8,000 per truck</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">$ 9,000 per truck</td>
    </tr>
  </tbody>
</table>

<p>The President faces a number of restrictions when trying to satisfy the requirements. Early winter weather in northern Russia has brought a deep freeze with much snow. Therefore, General Lankletter is opposed to sending truck convoys in the area.</p>

<ul>
  <li>He convinces the President to supply Saint Petersburg only through the air.</li>
  <li>Moreover, the truck routes into Rostov are quite limited, so that from each port at most 2,500 trucks can be sent to Rostov.</li>
  <li>The Ukrainian government is very sensitive about American airplanes flying through their air space. It restricts the U.S. military to at most 200 flights from Berlin to Rostov and to at most 200 flights from London to Rostov. (The U.S. military does not want to fly around the Ukraine and is thus restricted by the Ukrainian limitations.)</li>
</ul>

<p>How does the President satisfy each Russian city’s military requirements at minimum cost?</p>

<h3 id="an-lp-model">An LP model</h3>

<p>Our scenario lends itself well to a standard minimum cost flow formulation. Boston and Jacksonville are the <em>supply nodes</em>, Saint Petersburg, Moscow and Rostov are the <em>demand nodes</em> and every other node is a <em>transshipment node</em>. Each edge has a cost per unit of cargo associated with it, and some of the edges have maximum capacities as specified in the scenario.</p>

<p><img src="../assets/files/images/possible_routes_new.png" width="600" length="600" align="center" /></p>

<p>Let us write the mathematical model for this minimum cost flow problem.</p>

<p>Parameters:</p>

\[n := \text{number of nodes in the network}\]

\[c_{i, j}:= \text{cost (\$ / ton) of transportation along (i, j)}\]

\[u_{i, j} := \text{maximum capacity (ton) of the edge (i, j)}\]

\[b_i:= \text{net amount of cargo (tons) generated at node i}\]

<p>Variables:</p>

\[x_{i, j} := \text{tons of cargo transported along the edge (i, j)}\]

<p>Objective:</p>

\[\text{minimize}\ \sum_{i=1}^n \sum_{j=1}^n c_{i, j} x_{i, j}\]

<p>Constraints:</p>

\[\sum_{j=1}^n x_{i,j} - \sum_{j=1}^n x_{j, i} = b_i\ \quad i = 1, ..., n \quad \text{(Node Flow)}\]

\[x_{i, j} \le u_{i, j} \quad \text{(Capacity)}\]

\[x_{i, j}\ge 0\quad \text{(Non-negativity)}\]

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cleanup
</span><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">delete_attr</span><span class="p">(</span><span class="s">'cost'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Parameters
</span><span class="n">ROUTE_TYPE_TO_VEHICLE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'air'</span><span class="p">:</span> <span class="s">'Starlifter'</span><span class="p">,</span>
    <span class="s">'sea'</span><span class="p">:</span> <span class="s">'Transport'</span><span class="p">,</span>
    <span class="s">'land'</span><span class="p">:</span> <span class="s">'Truck'</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">VEHICLE_CAPACITY_TONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'Starlifter'</span><span class="p">:</span><span class="mi">150</span><span class="p">,</span>
    <span class="s">'Transport'</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span>
    <span class="s">'Truck'</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ROSTOV_TRUCK_NUM_LIMIT</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">BERLIN_TO_ROSTOV_FLIGHT_NUM_LIMIT</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">LONDON_TO_ROSTOV_FLIGHT_NUM_LIMIT</span> <span class="o">=</span> <span class="mi">200</span>

<span class="n">SUPPLY_AT_BOSTON</span> <span class="o">=</span> <span class="mi">500000</span>
<span class="n">SUPPLY_AT_JACKSONVILLE</span> <span class="o">=</span> <span class="mi">500000</span>
<span class="n">DEMAND_AT_STPETERSBURG</span> <span class="o">=</span> <span class="mi">320000</span>
<span class="n">DEMAND_AT_MOSCOW</span> <span class="o">=</span> <span class="mi">440000</span>
<span class="n">DEMAND_AT_ROSTOV</span> <span class="o">=</span> <span class="mi">240000</span>

<span class="n">SUPPLY_NODES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Jacksonville'</span><span class="p">]</span>
<span class="n">DEMAND_NODES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'StPetersburg'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">]</span>

<span class="n">EDGE_COSTS_PER_VEHICLE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Berlin'</span><span class="p">):</span> <span class="mi">50000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Hamburg'</span><span class="p">):</span> <span class="mi">30000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Istanbul'</span><span class="p">):</span> <span class="mi">55000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'London'</span><span class="p">):</span> <span class="mi">45000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Rotterdam'</span><span class="p">):</span> <span class="mi">30000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Napoli'</span><span class="p">):</span> <span class="mi">32000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Berlin'</span><span class="p">):</span> <span class="mi">57000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Hamburg'</span><span class="p">):</span> <span class="mi">48000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Istanbul'</span><span class="p">):</span> <span class="mi">61000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'London'</span><span class="p">):</span> <span class="mi">49000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Rotterdam'</span><span class="p">):</span> <span class="mi">44000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Napoli'</span><span class="p">):</span> <span class="mi">56000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">24000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">3000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">28000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">22000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">3000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">22000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">4000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">25000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">19000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">23000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">7000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">4000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">8000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">9000</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># computing edge costs
</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">EDGE_COSTS_PER_VEHICLE</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>  
    <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cost_per_vehicle</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">vehicle</span> <span class="o">=</span> <span class="n">ROUTE_TYPE_TO_VEHICLE</span><span class="p">[</span><span class="n">edge</span><span class="p">.</span><span class="n">route_type</span><span class="p">]</span>  
    <span class="n">vehicle_capacity_tons</span> <span class="o">=</span> <span class="n">VEHICLE_CAPACITY_TONS</span><span class="p">[</span><span class="n">vehicle</span><span class="p">]</span>
    <span class="n">cost_per_ton</span> <span class="o">=</span> <span class="n">cost_per_vehicle</span> <span class="o">/</span> <span class="n">vehicle_capacity_tons</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">cost_per_ton</span><span class="o">=</span><span class="n">cost_per_ton</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># computing edge capacities
</span>
<span class="c1">## start with infinite edge cpacities
</span><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">capacity_tons</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">inf</span>
    
<span class="c1">## Saint Petersburg is only reachable through air
</span><span class="n">edges_to_StPetersburg</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">target_name</span><span class="o">=</span><span class="s">'StPetersburg'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges_to_StPetersburg</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">edge</span><span class="p">.</span><span class="n">route_type</span> <span class="o">==</span> <span class="s">'land'</span><span class="p">:</span>
        <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">capacity_tons</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">## Limited # of trucks to Rostov
</span><span class="n">edges_to_Rostov</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">target_name</span><span class="o">=</span><span class="s">'Rostov'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges_to_Rostov</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">edge</span><span class="p">.</span><span class="n">route_type</span> <span class="o">==</span> <span class="s">'land'</span><span class="p">:</span>
        <span class="n">capacity_tons</span> <span class="o">=</span> <span class="n">ROSTOV_TRUCK_NUM_LIMIT</span> <span class="o">*</span> <span class="n">VEHICLE_CAPACITY_TONS</span><span class="p">[</span><span class="s">'Truck'</span><span class="p">]</span>
        <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">capacity_tons</span><span class="o">=</span><span class="n">capacity_tons</span><span class="p">)</span>

<span class="c1">## Limited # of flights over Ukrain
</span><span class="n">edge_Ber_Ros</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edge</span><span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">)</span>
<span class="n">edge_Ber_Ros</span><span class="p">.</span><span class="n">capacity_tons</span> <span class="o">=</span> <span class="n">BERLIN_TO_ROSTOV_FLIGHT_NUM_LIMIT</span> <span class="o">*</span> <span class="n">VEHICLE_CAPACITY_TONS</span><span class="p">[</span><span class="s">'Starlifter'</span><span class="p">]</span>

<span class="n">edge_Lon_Ros</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edge</span><span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">)</span>
<span class="n">edge_Lon_Ros</span><span class="p">.</span><span class="n">capacity_tons</span> <span class="o">=</span> <span class="n">LONDON_TO_ROSTOV_FLIGHT_NUM_LIMIT</span> <span class="o">*</span> <span class="n">VEHICLE_CAPACITY_TONS</span><span class="p">[</span><span class="s">'Starlifter'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">'Edge | Route_Type | Cost($/ton) | Limit(tons)'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'---- | ---------- | ----------- | -----------'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{s}-{t} | {r} | {c} | {capacity}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
    <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">r</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">route_type</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">round</span><span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">cost_per_ton</span><span class="p">),</span>
            <span class="n">capacity</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">capacity_tons</span>
    <span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Edge | Route_Type | Cost($/ton) | Limit(tons)
---- | ---------- | ----------- | -----------
Jacksonville-Istanbul | air | 407.0 | inf
Hamburg-Rostov | land | 438.0 | 40000
Jacksonville-Berlin | air | 380.0 | inf
London-StPetersburg | air | 147.0 | inf
Hamburg-StPetersburg | land | 188.0 | 0
London-Rostov | air | 27.0 | 30000
Napoli-Moscow | land | 312.0 | inf
Boston-Istanbul | air | 367.0 | inf
Jacksonville-Rotterdam | sea | 183.0 | inf
Boston-Berlin | air | 333.0 | inf
Boston-Napoli | sea | 133.0 | inf
Jacksonville-Hamburg | sea | 200.0 | inf
Hamburg-Moscow | land | 250.0 | inf
Rotterdam-Moscow | land | 312.0 | inf
Napoli-Rostov | land | 562.0 | 40000
Istanbul-Moscow | air | 167.0 | inf
Rotterdam-Rostov | land | 500.0 | 40000
Boston-London | air | 300.0 | inf
London-Moscow | air | 127.0 | inf
Boston-Rotterdam | sea | 125.0 | inf
Berlin-StPetersburg | air | 160.0 | inf
Jacksonville-Napoli | sea | 233.0 | inf
Napoli-StPetersburg | land | 312.0 | 0
Jacksonville-London | air | 327.0 | inf
Berlin-Rostov | air | 153.0 | 30000
Rotterdam-StPetersburg | land | 188.0 | 0
Berlin-Moscow | air | 147.0 | inf
Istanbul-Rostov | air | 13.0 | inf
Istanbul-StPetersburg | air | 187.0 | inf
Boston-Hamburg | sea | 125.0 | inf
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Variables
</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'x_{s}_{t} = cp.Variable(1, nonneg=True, name="x_{s}_{t}")'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'variables.append(x_{s}_{t})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>

<span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['x_Jacksonville_Istanbul',
 'x_Hamburg_Rostov',
 'x_Jacksonville_Berlin',
 'x_London_StPetersburg',
 'x_Hamburg_StPetersburg',
 'x_London_Rostov',
 'x_Napoli_Moscow',
 'x_Boston_Istanbul',
 'x_Jacksonville_Rotterdam',
 'x_Boston_Berlin',
 'x_Boston_Napoli',
 'x_Jacksonville_Hamburg',
 'x_Hamburg_Moscow',
 'x_Rotterdam_Moscow',
 'x_Napoli_Rostov',
 'x_Istanbul_Moscow',
 'x_Rotterdam_Rostov',
 'x_Boston_London',
 'x_London_Moscow',
 'x_Boston_Rotterdam',
 'x_Berlin_StPetersburg',
 'x_Jacksonville_Napoli',
 'x_Napoli_StPetersburg',
 'x_Jacksonville_London',
 'x_Berlin_Rostov',
 'x_Rotterdam_StPetersburg',
 'x_Berlin_Moscow',
 'x_Istanbul_Rostov',
 'x_Istanbul_StPetersburg',
 'x_Boston_Hamburg']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Objective
</span>
<span class="n">obj_str</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">cost_per_ton</span>
    <span class="n">obj_str</span> <span class="o">+=</span> <span class="s">'+ {c} * x_{s}_{t}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cost</span><span class="p">)</span>
    
<span class="k">exec</span><span class="p">(</span><span class="s">'obj_min_cost_flow = cp.Minimize({})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">obj_str</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Constraints
</span>
<span class="c1">## flow constraints
</span>
<span class="n">node_flow_constraints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">vertices</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'Boston'</span><span class="p">:</span>  <span class="c1"># supply node
</span>        <span class="n">b</span> <span class="o">=</span> <span class="n">SUPPLY_AT_BOSTON</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'Jacksonville'</span><span class="p">:</span>  <span class="c1"># supply node
</span>        <span class="n">b</span> <span class="o">=</span> <span class="n">SUPPLY_AT_JACKSONVILLE</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'StPetersburg'</span><span class="p">:</span>  <span class="c1"># demand node
</span>        <span class="n">b</span> <span class="o">=</span>  <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">DEMAND_AT_STPETERSBURG</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'Moscow'</span><span class="p">:</span>  <span class="c1"># demand node
</span>        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">DEMAND_AT_MOSCOW</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'Rostov'</span><span class="p">:</span>  <span class="c1"># demand node
</span>        <span class="n">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">DEMAND_AT_ROSTOV</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># transshipment node
</span>    <span class="n">v</span><span class="p">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        
    <span class="n">constr_out_str</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">constr_in_str</span> <span class="o">=</span> <span class="s">''</span>
    <span class="c1"># outbound
</span>    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DEMAND_NODES</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">constr_out_str</span> <span class="o">+=</span> <span class="s">'x_{s}_{t} + '</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
                <span class="n">s</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">constr_out_str</span> <span class="o">=</span> <span class="n">constr_out_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> 
    <span class="c1"># inbound
</span>    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SUPPLY_NODES</span><span class="p">:</span>
        <span class="n">constr_in_str</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">target_name</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">constr_in_str</span> <span class="o">+=</span> <span class="s">' - x_{s}_{t}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">constr_str</span> <span class="o">=</span> <span class="n">constr_out_str</span> <span class="o">+</span> <span class="n">constr_in_str</span> <span class="o">+</span> <span class="s">' == {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">constr</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">constr_str</span><span class="p">)</span>
    <span class="n">node_flow_constraints</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    
<span class="c1">## edge capacity constraints
</span>
<span class="n">capacity_constraints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">constr</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s">'x_{s}_{t} &lt;= edge.capacity_tons'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
    <span class="n">capacity_constraints</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</code></pre></div></div>

<p>Note that the above problem satisfies the <strong>Feasible Solution Property</strong> of minimum cost flow problems. viz. the problem has a feasible solution only if \(\sum_{i = 1}^n b_i = 0\). Clearly in our case, this is true because the total supply at Boston and Jacksonville is equal to the total demand at St Petersburg, Moscow and Rostov, viz. \(500,000\) tons.</p>

<p>It is also worth noting that we do not need to restrict \(x_{i, j}\) to be integers. This follows from the <strong>Integer Solutions Property</strong> of minimum cost flow problems. This property implies that if \(b_i\) and \(u_{i, j}\) are integers, then so is every feasible solution of the problem. Hence, we can get away by formulating the above problem as a Linear Program and not an Integer Program!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Model
</span><span class="n">prob_min_cost_flow</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">obj_min_cost_flow</span><span class="p">,</span> <span class="n">node_flow_constraints</span> <span class="o">+</span> <span class="n">capacity_constraints</span><span class="p">)</span>
<span class="n">prob_min_cost_flow</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="p">.</span><span class="n">GLPK</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===============================================================================
                                     CVXPY                                     
                                     v1.3.1                                    
===============================================================================
(CVXPY) Jun 07 07:08:40 PM: Your problem has 30 variables, 41 constraints, and 0 parameters.
(CVXPY) Jun 07 07:08:40 PM: It is compliant with the following grammars: DCP, DQCP
(CVXPY) Jun 07 07:08:40 PM: (If you need to solve this problem multiple times, but with different data, consider using parameters.)
(CVXPY) Jun 07 07:08:40 PM: CVXPY will first compile your problem; then, it will invoke a numerical solver to obtain a solution.
-------------------------------------------------------------------------------
                                  Compilation                                  
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:40 PM: Compiling problem (target solver=GLPK).
(CVXPY) Jun 07 07:08:40 PM: Reduction chain: Dcp2Cone -&gt; CvxAttr2Constr -&gt; ConeMatrixStuffing -&gt; GLPK
(CVXPY) Jun 07 07:08:40 PM: Applying reduction Dcp2Cone
(CVXPY) Jun 07 07:08:40 PM: Applying reduction CvxAttr2Constr
(CVXPY) Jun 07 07:08:40 PM: Applying reduction ConeMatrixStuffing
(CVXPY) Jun 07 07:08:40 PM: Applying reduction GLPK
(CVXPY) Jun 07 07:08:40 PM: Finished problem compilation (took 1.044e-01 seconds).
-------------------------------------------------------------------------------
                                Numerical solver                               
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:40 PM: Invoking solver GLPK  to obtain a solution.
-------------------------------------------------------------------------------
                                    Summary                                    
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:40 PM: Problem status: optimal
GLPK Simplex Optimizer 5.0
71 rows, 30 columns, 120 non-zeros
      0: obj =               nan inf =   2.000e+06 (5)
      5: obj =               nan inf =   0.000e+00 (0)
*    31: obj =               nan inf =   0.000e+00 (0)
OPTIMAL LP SOLUTION FOUND
(CVXPY) Jun 07 07:08:40 PM: Optimal value: 4.129e+08
(CVXPY) Jun 07 07:08:40 PM: Compilation took 1.044e-01 seconds
(CVXPY) Jun 07 07:08:40 PM: Solver (including time spent in interface) took 7.927e-04 seconds





412866666.6666666
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span> <span class="o">=</span> <span class="n">get_result_summary</span><span class="p">(</span><span class="n">prob_min_cost_flow</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'optimal'
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">[</span><span class="s">'optimal_value'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>412866666.6666666
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">prettify</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s">'optimal_solution'</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">.</span><span class="n">value</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>x_Boston_Hamburg</td>
      <td>440000.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>x_Boston_Istanbul</td>
      <td>60000.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>x_Hamburg_Moscow</td>
      <td>440000.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>x_Istanbul_Rostov</td>
      <td>210000.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>x_Jacksonville_Istanbul</td>
      <td>150000.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>x_Jacksonville_London</td>
      <td>350000.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>x_London_Rostov</td>
      <td>30000.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>x_London_StPetersburg</td>
      <td>320000.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Hence we conclude that the United States can meet the cargo requirements at three Russian cities at a minimum cost of <strong>$ 412,866,667</strong> while honoring all the specified restrictions. The corresponding optimal solution is shown below:
 <img src="../assets/files/images/min_cost_flow_optimal_soln.png" width="600" length="600" align="center" /></p>

<h2 id="scenario-3-when-you-cannot-do-everything-do-the-best-you-can">Scenario 3: When you cannot do everything, do the best you can!</h2>
<h3 id="a-maximum-flow-problem">A maximum flow problem</h3>

<p>Once the President releases the number of planes, ships, and trucks that will travel between the United States and the Russian Federation, Tabitha Neal contacts each of the American cities and NATO countries to indicate the number of planes to expect at the airfields, the number of ships to expect at the docks, and the number of trucks to expect traveling across the roads. Unfortunately, Tabitha learns that several additional restrictions exist which cannot be immediately eliminated. Because of airfield congestion and unalterable flight schedules, only a limited number of planes may be sent between any two cities. These plane limitations are given below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">From</th>
      <th style="text-align: left">To</th>
      <th style="text-align: left">Maximum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">300 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">500 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Boston</td>
      <td style="text-align: left">London</td>
      <td style="text-align: left">500 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">500 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">700 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Jacksonville</td>
      <td style="text-align: left">London</td>
      <td style="text-align: left">600 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">500 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">0 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Saint Petersburg</td>
      <td style="text-align: left">1,000 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">300 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">100 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">200 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Berlin</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">0 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">Istanbul</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">900 airplanes</td>
    </tr>
    <tr>
      <td style="text-align: left">London</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">100 airplanes</td>
    </tr>
  </tbody>
</table>

<p>In addition, because some countries fear that citizens will become alarmed if too many military trucks travel the public highways, they object to a large number of trucks traveling through their countries. These objections mean that a limited number of trucks are able to travel between certain ports and Russian cities. These limitations are listed below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">From</th>
      <th style="text-align: left">To</th>
      <th style="text-align: left">Maximum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">600 trucks</td>
    </tr>
    <tr>
      <td style="text-align: left">Rotterdam</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">750 trucks</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">700 trucks</td>
    </tr>
    <tr>
      <td style="text-align: left">Hamburg</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">500 trucks</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Moscow</td>
      <td style="text-align: left">1,500 trucks</td>
    </tr>
    <tr>
      <td style="text-align: left">Napoli</td>
      <td style="text-align: left">Rostov</td>
      <td style="text-align: left">1,400 trucks</td>
    </tr>
  </tbody>
</table>

<p>Tabitha learns that all shipping lanes have no capacity limits, owing to the American control of the Atlantic Ocean.
The President realizes that because of all the restrictions <strong>he will not be able to satisfy all the reinforcement requirements of the three Russian cities</strong>. He decides to disregard the cost issue and instead to maximize the total amount of cargo he can get to the Russian cities.</p>

<p>How does the President maximize the total amount of cargo that reaches the Russian Federation?</p>

<h3 id="an-lp-formulation">An LP formulation</h3>

<p>The current scenario appears very similar to the standard <em>Maximum Flow</em> problem where we want to maximize the flow through a network while honoring the capacity of each edge in the network. Next, we note that <strong>the maximum flow problem is just a special case of the minimum cost flow problem</strong> and we can reuse the model in the previous section with the following modifications.</p>
<ol>
  <li>We add a new Source node \(S\) with total supply of 1 million tons and a new target node \(T\) with total demand of 1 million tons.</li>
  <li>We add a direct edge from the \(S\) to \(T\) with infinite cost and infinite capacity.</li>
  <li>We assign zero cost to all edges in the network except the edge \(S\)–&gt;\(T\).</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">M</span> <span class="o">=</span> <span class="mf">1.0e10</span>
<span class="n">SUPPLY_UPPER_BOUND_TONS</span> <span class="o">=</span> <span class="mi">1000000</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add fictitious source and target
</span><span class="n">graph</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s">'S'</span><span class="p">,</span> <span class="s">'Boston'</span><span class="p">))</span>
<span class="n">graph</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s">'S'</span><span class="p">,</span> <span class="s">'Jacksonville'</span><span class="p">))</span>

<span class="n">graph</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s">'StPetersburg'</span><span class="p">,</span> <span class="s">'T'</span><span class="p">))</span>
<span class="n">graph</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s">'Moscow'</span><span class="p">,</span> <span class="s">'T'</span><span class="p">))</span>
<span class="n">graph</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s">'Rostov'</span><span class="p">,</span> <span class="s">'T'</span><span class="p">))</span>

<span class="c1"># Add a direct edge from the  𝑆 to  𝑇
</span><span class="n">graph</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="s">'S'</span><span class="p">,</span> <span class="s">'T'</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make all edge costs zero
</span><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">cost_per_ton</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
<span class="c1"># Assign infinite cost to S--&gt;T
</span><span class="n">s_t</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edge</span><span class="p">(</span><span class="s">'S'</span><span class="p">,</span> <span class="s">'T'</span><span class="p">)</span>
<span class="n">s_t</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">cost_per_ton</span><span class="o">=</span><span class="n">M</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Initialize all edge capacities to infinity
</span><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">capacity_vehicle_units</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">capacity_tons</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="p">)</span>
    
<span class="c1"># Assign edge cpacities in vehicle count and tons
</span><span class="n">EDGE_CAPACITIES_IN_VEHICLE_NUMS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Berlin'</span><span class="p">):</span> <span class="mi">300</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'Istanbul'</span><span class="p">):</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Boston'</span><span class="p">,</span> <span class="s">'London'</span><span class="p">):</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Berlin'</span><span class="p">):</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'Istanbul'</span><span class="p">):</span> <span class="mi">700</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Jacksonville'</span><span class="p">,</span> <span class="s">'London'</span><span class="p">):</span> <span class="mi">600</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'StPetersburg'</span><span class="p">):</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">300</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">200</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Berlin'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Istanbul'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">900</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'London'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">100</span><span class="p">,</span>

    <span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">600</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Rotterdam'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">750</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">700</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Hamburg'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">500</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'Moscow'</span><span class="p">):</span> <span class="mi">1500</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'Napoli'</span><span class="p">,</span> <span class="s">'Rostov'</span><span class="p">):</span> <span class="mi">1400</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">EDGE_CAPACITIES_IN_VEHICLE_NUMS</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">capacity_vehicle_units</span> <span class="o">=</span> <span class="n">c</span>

    <span class="n">vehicle</span> <span class="o">=</span> <span class="n">ROUTE_TYPE_TO_VEHICLE</span><span class="p">[</span><span class="n">edge</span><span class="p">.</span><span class="n">route_type</span><span class="p">]</span>
    <span class="n">vehicle_capacity_tons</span> <span class="o">=</span> <span class="n">VEHICLE_CAPACITY_TONS</span><span class="p">[</span><span class="n">vehicle</span><span class="p">]</span>

    <span class="n">edge_capacity_tons</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">capacity_vehicle_units</span> <span class="o">*</span> <span class="n">vehicle_capacity_tons</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">capacity_tons</span><span class="o">=</span><span class="n">edge_capacity_tons</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Variables
</span><span class="n">variables</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'x_{s}_{t} = cp.Variable(1, nonneg=True, name="x_{s}_{t}")'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">exec</span><span class="p">(</span><span class="s">'variables.append(x_{s}_{t})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>

<span class="nb">sorted</span><span class="p">([</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['x_Berlin_Moscow',
 'x_Berlin_Rostov',
 'x_Berlin_StPetersburg',
 'x_Boston_Berlin',
 'x_Boston_Hamburg',
 'x_Boston_Istanbul',
 'x_Boston_London',
 'x_Boston_Napoli',
 'x_Boston_Rotterdam',
 'x_Hamburg_Moscow',
 'x_Hamburg_Rostov',
 'x_Hamburg_StPetersburg',
 'x_Istanbul_Moscow',
 'x_Istanbul_Rostov',
 'x_Istanbul_StPetersburg',
 'x_Jacksonville_Berlin',
 'x_Jacksonville_Hamburg',
 'x_Jacksonville_Istanbul',
 'x_Jacksonville_London',
 'x_Jacksonville_Napoli',
 'x_Jacksonville_Rotterdam',
 'x_London_Moscow',
 'x_London_Rostov',
 'x_London_StPetersburg',
 'x_Moscow_T',
 'x_Napoli_Moscow',
 'x_Napoli_Rostov',
 'x_Napoli_StPetersburg',
 'x_Rostov_T',
 'x_Rotterdam_Moscow',
 'x_Rotterdam_Rostov',
 'x_Rotterdam_StPetersburg',
 'x_S_Boston',
 'x_S_Jacksonville',
 'x_S_T',
 'x_StPetersburg_T']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Objective
</span><span class="n">obj_str</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">):</span>
    <span class="n">obj_str</span> <span class="o">+=</span> <span class="s">'+ {c} * x_{s}_{t}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">cost_per_ton</span><span class="p">)</span>
    
<span class="k">exec</span><span class="p">(</span><span class="s">'obj_max_flow = cp.Minimize({})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">obj_str</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">obj_max_flow</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>minimize 0.0 @ x_Berlin_StPetersburg + 0.0 @ x_Berlin_Rostov + 0.0 @ x_Berlin_Moscow + 0.0 @ x_Boston_Istanbul + 0.0 @ x_Boston_Berlin + 0.0 @ x_Boston_Napoli + 0.0 @ x_Boston_London + 0.0 @ x_Boston_Rotterdam + 0.0 @ x_Boston_Hamburg + 0.0 @ x_Hamburg_Rostov + 0.0 @ x_Hamburg_StPetersburg + 0.0 @ x_Hamburg_Moscow + 0.0 @ x_Istanbul_Moscow + 0.0 @ x_Istanbul_Rostov + 0.0 @ x_Istanbul_StPetersburg + 0.0 @ x_Jacksonville_Istanbul + 0.0 @ x_Jacksonville_Berlin + 0.0 @ x_Jacksonville_Rotterdam + 0.0 @ x_Jacksonville_Hamburg + 0.0 @ x_Jacksonville_Napoli + 0.0 @ x_Jacksonville_London + 0.0 @ x_London_StPetersburg + 0.0 @ x_London_Rostov + 0.0 @ x_London_Moscow + 0.0 @ x_Moscow_T + 0.0 @ x_Napoli_Moscow + 0.0 @ x_Napoli_Rostov + 0.0 @ x_Napoli_StPetersburg + 0.0 @ x_Rostov_T + 0.0 @ x_Rotterdam_Moscow + 0.0 @ x_Rotterdam_Rostov + 0.0 @ x_Rotterdam_StPetersburg + 10000000000.0 @ x_S_T + 0.0 @ x_S_Jacksonville + 0.0 @ x_S_Boston + 0.0 @ x_StPetersburg_T
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Constraints
## Update the node flow constraints
</span><span class="n">node_flow_constraints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'S'</span><span class="p">:</span>  <span class="c1"># supply node
</span>        <span class="n">b</span> <span class="o">=</span> <span class="n">SUPPLY_UPPER_BOUND_TONS</span>
    <span class="k">elif</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">'T'</span><span class="p">:</span>  <span class="c1"># demand node
</span>        <span class="n">b</span> <span class="o">=</span>  <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">SUPPLY_UPPER_BOUND_TONS</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># transshipment node
</span>    <span class="n">v</span><span class="p">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    
    <span class="n">constr_out_str</span> <span class="o">=</span> <span class="s">''</span>
    <span class="n">constr_in_str</span> <span class="o">=</span> <span class="s">''</span>
    <span class="c1"># outbound
</span>    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">'T'</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">constr_out_str</span> <span class="o">+=</span> <span class="s">'x_{s}_{t} + '</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
                <span class="n">s</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">constr_out_str</span> <span class="o">=</span> <span class="n">constr_out_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> 
    <span class="c1"># inbound
</span>    <span class="k">if</span> <span class="n">v</span><span class="p">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">'S'</span><span class="p">:</span>
        <span class="n">constr_in_str</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">target_name</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">constr_in_str</span> <span class="o">+=</span> <span class="s">' - x_{s}_{t}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">v</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">constr_str</span> <span class="o">=</span> <span class="n">constr_out_str</span> <span class="o">+</span> <span class="n">constr_in_str</span> <span class="o">+</span> <span class="s">' == {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">constr</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">constr_str</span><span class="p">)</span>
    <span class="n">node_flow_constraints</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{}</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">constr</span><span class="p">))</span>   
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Vertex: Berlin
x_Berlin_StPetersburg + x_Berlin_Rostov + x_Berlin_Moscow + -x_Jacksonville_Berlin + -x_Boston_Berlin == 0.0

Vertex: Boston
x_Boston_Istanbul + x_Boston_Berlin + x_Boston_Napoli + x_Boston_London + x_Boston_Rotterdam + x_Boston_Hamburg + -x_S_Boston == 0.0

Vertex: Hamburg
x_Hamburg_Rostov + x_Hamburg_StPetersburg + x_Hamburg_Moscow + -x_Jacksonville_Hamburg + -x_Boston_Hamburg == 0.0

Vertex: Istanbul
x_Istanbul_Moscow + x_Istanbul_Rostov + x_Istanbul_StPetersburg + -x_Jacksonville_Istanbul + -x_Boston_Istanbul == 0.0

Vertex: Jacksonville
x_Jacksonville_Istanbul + x_Jacksonville_Berlin + x_Jacksonville_Rotterdam + x_Jacksonville_Hamburg + x_Jacksonville_Napoli + x_Jacksonville_London + -x_S_Jacksonville == 0.0

Vertex: London
x_London_StPetersburg + x_London_Rostov + x_London_Moscow + -x_Boston_London + -x_Jacksonville_London == 0.0

Vertex: Moscow
x_Moscow_T + -x_Napoli_Moscow + -x_Hamburg_Moscow + -x_Rotterdam_Moscow + -x_Istanbul_Moscow + -x_London_Moscow + -x_Berlin_Moscow == 0.0

Vertex: Napoli
x_Napoli_Moscow + x_Napoli_Rostov + x_Napoli_StPetersburg + -x_Boston_Napoli + -x_Jacksonville_Napoli == 0.0

Vertex: Rostov
x_Rostov_T + -x_Hamburg_Rostov + -x_London_Rostov + -x_Napoli_Rostov + -x_Rotterdam_Rostov + -x_Berlin_Rostov + -x_Istanbul_Rostov == 0.0

Vertex: Rotterdam
x_Rotterdam_Moscow + x_Rotterdam_Rostov + x_Rotterdam_StPetersburg + -x_Jacksonville_Rotterdam + -x_Boston_Rotterdam == 0.0

Vertex: S
x_S_T + x_S_Jacksonville + x_S_Boston == 1000000.0

Vertex: StPetersburg
x_StPetersburg_T + -x_London_StPetersburg + -x_Hamburg_StPetersburg + -x_Berlin_StPetersburg + -x_Napoli_StPetersburg + -x_Rotterdam_StPetersburg + -x_Istanbul_StPetersburg == 0.0

Vertex: T
-x_StPetersburg_T + -x_S_T + -x_Moscow_T + -x_Rostov_T == -1000000.0
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Update the edge capacity constraints
</span><span class="n">capacity_constraints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">):</span>
    <span class="n">constr</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s">'x_{s}_{t} &lt;= edge.capacity_tons'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
        <span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">))</span>
    <span class="n">capacity_constraints</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_Berlin_StPetersburg &lt;= 75000.0
x_Berlin_Rostov &lt;= 0.0
x_Berlin_Moscow &lt;= 45000.0
x_Boston_Istanbul &lt;= 75000.0
x_Boston_Berlin &lt;= 45000.0
x_Boston_Napoli &lt;= inf
x_Boston_London &lt;= 75000.0
x_Boston_Rotterdam &lt;= inf
x_Boston_Hamburg &lt;= inf
x_Hamburg_Rostov &lt;= 8000.0
x_Hamburg_StPetersburg &lt;= inf
x_Hamburg_Moscow &lt;= 11200.0
x_Istanbul_Moscow &lt;= 15000.0
x_Istanbul_Rostov &lt;= 135000.0
x_Istanbul_StPetersburg &lt;= 0.0
x_Jacksonville_Istanbul &lt;= 105000.0
x_Jacksonville_Berlin &lt;= 75000.0
x_Jacksonville_Rotterdam &lt;= inf
x_Jacksonville_Hamburg &lt;= inf
x_Jacksonville_Napoli &lt;= inf
x_Jacksonville_London &lt;= 90000.0
x_London_StPetersburg &lt;= 150000.0
x_London_Rostov &lt;= 15000.0
x_London_Moscow &lt;= 30000.0
x_Moscow_T &lt;= inf
x_Napoli_Moscow &lt;= 24000.0
x_Napoli_Rostov &lt;= 22400.0
x_Napoli_StPetersburg &lt;= inf
x_Rostov_T &lt;= inf
x_Rotterdam_Moscow &lt;= 9600.0
x_Rotterdam_Rostov &lt;= 12000.0
x_Rotterdam_StPetersburg &lt;= inf
x_S_T &lt;= inf
x_S_Jacksonville &lt;= inf
x_S_Boston &lt;= inf
x_StPetersburg_T &lt;= inf
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prob_max_flow</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">obj_max_flow</span><span class="p">,</span> <span class="n">node_flow_constraints</span> <span class="o">+</span> <span class="n">capacity_constraints</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prob_max_flow</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="p">.</span><span class="n">GLPK</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===============================================================================
                                     CVXPY                                     
                                     v1.3.1                                    
===============================================================================
(CVXPY) Jun 07 07:08:41 PM: Your problem has 36 variables, 49 constraints, and 0 parameters.
(CVXPY) Jun 07 07:08:41 PM: It is compliant with the following grammars: DCP, DQCP
(CVXPY) Jun 07 07:08:41 PM: (If you need to solve this problem multiple times, but with different data, consider using parameters.)
(CVXPY) Jun 07 07:08:41 PM: CVXPY will first compile your problem; then, it will invoke a numerical solver to obtain a solution.
-------------------------------------------------------------------------------
                                  Compilation                                  
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:41 PM: Compiling problem (target solver=GLPK).
(CVXPY) Jun 07 07:08:41 PM: Reduction chain: Dcp2Cone -&gt; CvxAttr2Constr -&gt; ConeMatrixStuffing -&gt; GLPK
(CVXPY) Jun 07 07:08:41 PM: Applying reduction Dcp2Cone
(CVXPY) Jun 07 07:08:41 PM: Applying reduction CvxAttr2Constr
(CVXPY) Jun 07 07:08:41 PM: Applying reduction ConeMatrixStuffing
(CVXPY) Jun 07 07:08:41 PM: Applying reduction GLPK
(CVXPY) Jun 07 07:08:41 PM: Finished problem compilation (took 1.826e-01 seconds).
-------------------------------------------------------------------------------
                                Numerical solver                               
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:41 PM: Invoking solver GLPK  to obtain a solution.
GLPK Simplex Optimizer 5.0
85 rows, 36 columns, 144 non-zeros
-------------------------------------------------------------------------------
                                    Summary                                    
-------------------------------------------------------------------------------
(CVXPY) Jun 07 07:08:41 PM: Problem status: optimal
      0: obj =               nan inf =   2.000e+06 (2)
      1: obj =               nan inf =   0.000e+00 (0)
*    27: obj =               nan inf =   0.000e+00 (0)
OPTIMAL LP SOLUTION FOUND
(CVXPY) Jun 07 07:08:41 PM: Optimal value: 0.000e+00
(CVXPY) Jun 07 07:08:41 PM: Compilation took 1.826e-01 seconds
(CVXPY) Jun 07 07:08:41 PM: Solver (including time spent in interface) took 8.690e-04 seconds





0.0
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span> <span class="o">=</span> <span class="n">get_result_summary</span><span class="p">(</span><span class="n">prob_max_flow</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'optimal'
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">[</span><span class="s">'optimal_value'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.0
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">prettify</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s">'optimal_solution'</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">].</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s">'variable'</span><span class="p">)</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>x_Berlin_Moscow</td>
      <td>45000.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>x_Boston_Berlin</td>
      <td>45000.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>x_Boston_Hamburg</td>
      <td>692000.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>x_Boston_Istanbul</td>
      <td>75000.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>x_Boston_London</td>
      <td>45000.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>x_Boston_Napoli</td>
      <td>46400.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>x_Boston_Rotterdam</td>
      <td>21600.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>x_Hamburg_Moscow</td>
      <td>11200.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>x_Hamburg_Rostov</td>
      <td>8000.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>x_Hamburg_StPetersburg</td>
      <td>672800.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>x_Istanbul_Moscow</td>
      <td>15000.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>x_Istanbul_Rostov</td>
      <td>135000.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>x_Jacksonville_Istanbul</td>
      <td>75000.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>x_London_Moscow</td>
      <td>30000.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>x_London_Rostov</td>
      <td>15000.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>x_Moscow_T</td>
      <td>134800.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>x_Napoli_Moscow</td>
      <td>24000.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>x_Napoli_Rostov</td>
      <td>22400.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>x_Rostov_T</td>
      <td>192400.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>x_Rotterdam_Moscow</td>
      <td>9600.0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>x_Rotterdam_Rostov</td>
      <td>12000.0</td>
    </tr>
    <tr>
      <th>32</th>
      <td>x_S_Boston</td>
      <td>925000.0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>x_S_Jacksonville</td>
      <td>75000.0</td>
    </tr>
    <tr>
      <th>35</th>
      <td>x_StPetersburg_T</td>
      <td>672800.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>The optimal soution is shown below</p>

<p><img src="../assets/files/images/max_flow_optimal_solution_new.png" width="700" length="700" /></p>

<p>Points to note:</p>
<ul>
  <li>The total cargo (1 million tons) shipped from the US reaches the Russian Federation.</li>
  <li>However, as expected, the individual requirements of the three cities from the previous scenario could not be satisfied. E.g. the total cargo reaching Rostov is 192,400 tons while the cargo requirement at Rostov from the previous scenario was 240,000 tons.</li>
  <li>The above optimal solution is not unique. In other words, ignoring all costs, there are other ways to send all of the cargo from US to the Russian Federation.</li>
</ul>

<p>Hence, we conclude that if the President could choose to ignore the edge costs and the individual city requirements in the interest of making sure that all the intended cargo reaches the Russian Federation, the above solution will accomplish that. However, a logical question is: <em>what would the above solution cost?</em></p>

<p>In order to answer this question, we use the edge costs specified in the previous scenario.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">EDGE_COSTS_PER_VEHICLE</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>  
    <span class="n">edge</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cost_per_vehicle</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">vehicle</span> <span class="o">=</span> <span class="n">ROUTE_TYPE_TO_VEHICLE</span><span class="p">[</span><span class="n">edge</span><span class="p">.</span><span class="n">route_type</span><span class="p">]</span>  
    <span class="n">vehicle_capacity_tons</span> <span class="o">=</span> <span class="n">VEHICLE_CAPACITY_TONS</span><span class="p">[</span><span class="n">vehicle</span><span class="p">]</span>
    <span class="n">cost_per_ton</span> <span class="o">=</span> <span class="n">cost_per_vehicle</span> <span class="o">/</span> <span class="n">vehicle_capacity_tons</span>
    <span class="n">edge</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">cost_per_ton</span><span class="o">=</span><span class="n">cost_per_ton</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">obj_str</span> <span class="o">=</span> <span class="s">''</span>
<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">edge</span><span class="p">.</span><span class="n">cost_per_ton</span>
    <span class="n">obj_str</span> <span class="o">+=</span> <span class="s">'+ {c} * x_{s}_{t}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">cost</span><span class="p">)</span>
    
<span class="k">exec</span><span class="p">(</span><span class="s">'obj_min_cost_flow = cp.Minimize({})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">obj_str</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">obj_min_cost_flow</span><span class="p">.</span><span class="n">value</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>358536666.6666666
</code></pre></div></div>

<p>As seen above, the optimal solution for the maximum cost flow problem shown above has a cost of <strong>$ 358,536,667</strong>. By contrast, the optimal solution to the minimum cost flow model is <strong>$ 412,866,667</strong>. This may seem counterintuitive because we expect that trying to minimize the total cost should give a smaller optimal value. However, the reason for the above disparity is that in the minimum cost flow problem, we were trying to satisfy the demand constraints at each of the three demand nodes - Saint Petersburg, Moscow and Rostov. However, in the maximum flow problem, we relaxed these constraints and were able to achieve an overall cheaper solution!</p>

<h2 id="scenario-4-re-establishing-communications">Scenario 4: Re-establishing communications</h2>

<h3 id="a-minimum-spanning-tree-mst-problem">A minimum spanning tree (MST) problem</h3>
<p>Even before all American troops and supplies had reached Saint Petersburg, Moscow, and Rostov, infighting among Commander Votachev’s troops about whether to make the next attack against Saint Petersburg or against Moscow split the revolutionaries. Troops from Moscow easily overcame the vulnerable revolutionaries. Commander Votachev was imprisoned, and the next step became rebuilding the seven cities razed by his armies.</p>

<p>The President’s top priority is to help the Russian government to reestablish communications between the seven Russian cities and Moscow at minimum cost. The price of installing communication lines between any two Russian cities varies given the cost of shipping wire to the area, the level of destruction in the area, and the roughness of the terrain.
Luckily, a city is able to communicate with all others if it is connected only indirectly to every other city. Saint Petersburg and Rostov are already connected to Moscow, so if any of the seven cities is connected to Saint Petersburg or Rostov, it will also be connected to Moscow. The cost of replacing communication lines between two given cities for which this is possible is shown below.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Between</th>
      <th style="text-align: right">Cost($)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Saint Petersburg and Kazan</td>
      <td style="text-align: right">210,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Saint Petersburg and Perm</td>
      <td style="text-align: right">185,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Saint Petersburg and Ufa</td>
      <td style="text-align: right">225,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Moscow and Ufa</td>
      <td style="text-align: right">310,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Moscow and Samara</td>
      <td style="text-align: right">195,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Moscow and Orenburg</td>
      <td style="text-align: right">440,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Moscow and Saratov</td>
      <td style="text-align: right">140,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Rostov and Saratov</td>
      <td style="text-align: right">200,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Rostov and Orenburg</td>
      <td style="text-align: right">120,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Kazan and Perm</td>
      <td style="text-align: right">150,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Kazan and Ufa</td>
      <td style="text-align: right">105,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Kazan and Samara</td>
      <td style="text-align: right">95,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Perm and Yekaterinburg</td>
      <td style="text-align: right">85,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Perm and Ufa</td>
      <td style="text-align: right">125,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Yekaterinburg and Ufa</td>
      <td style="text-align: right">125,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Ufa and Samara</td>
      <td style="text-align: right">100,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Ufa and Orenburg</td>
      <td style="text-align: right">75,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Saratov and Samara</td>
      <td style="text-align: right">100,000</td>
    </tr>
    <tr>
      <td style="text-align: left">Saratov and Orenburg</td>
      <td style="text-align: right">95,000</td>
    </tr>
  </tbody>
</table>

<p>The minimum spanning tree problem can be solved in multiple ways. One way is to set it up as a Binary Integer Programming problem and then use a Branch and Bound algorithm to solve it. (We will see how this formulation works later.)</p>

<p>A more efficient way, especially for larger problems with sparse graphs, is to use the specialized minimum spanning tree (MST) algorithm which is more lightweight and well suited for an MST problem in the standard form (which is the case for us.) We will directly use the custom implementation of the MST algorithm from the <code class="language-plaintext highlighter-rouge">solver</code> module.</p>

<h3 id="the-mst-algorithm">The MST algorithm</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">edge_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'StPetersburg'</span><span class="p">,</span>  <span class="s">'Kazan'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">210000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'StPetersburg'</span><span class="p">,</span>  <span class="s">'Perm'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">185000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'StPetersburg'</span><span class="p">,</span>  <span class="s">'Ufa'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">225000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Moscow'</span><span class="p">,</span>  <span class="s">'Ufa'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">310000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Moscow'</span><span class="p">,</span>  <span class="s">'Samara'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">195000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Moscow'</span><span class="p">,</span>  <span class="s">'Orenburg'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">440000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Moscow'</span><span class="p">,</span>  <span class="s">'Saratov'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">140000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Rostov'</span><span class="p">,</span>  <span class="s">'Saratov'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">200000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Rostov'</span><span class="p">,</span>  <span class="s">'Orenburg'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">120000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Kazan'</span><span class="p">,</span>  <span class="s">'Perm'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">150000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Kazan'</span><span class="p">,</span>  <span class="s">'Ufa'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">105000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Kazan'</span><span class="p">,</span>  <span class="s">'Samara'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">95000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Perm'</span><span class="p">,</span>  <span class="s">'Yekaterinburg'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">85000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Perm'</span><span class="p">,</span>  <span class="s">'Ufa'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">125000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Yekaterinburg'</span><span class="p">,</span>  <span class="s">'Ufa'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">125000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Ufa'</span><span class="p">,</span>  <span class="s">'Samara'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">100000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Ufa'</span><span class="p">,</span>  <span class="s">'Orenburg'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">75000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Saratov'</span><span class="p">,</span>  <span class="s">'Samara'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">100000</span><span class="p">),</span>
    <span class="n">Edge</span><span class="p">(</span><span class="s">'Saratov'</span><span class="p">,</span>  <span class="s">'Orenburg'</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">95000</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">edge_list</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># make it an undirected graph
</span><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edge_list</span><span class="p">:</span>
    <span class="n">reverse_edge</span> <span class="o">=</span> <span class="n">Edge</span><span class="p">(</span>
        <span class="n">edge</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">edge</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="n">edge</span><span class="p">.</span><span class="n">cost</span><span class="p">)</span>
    <span class="n">graph</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">reverse_edge</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">.</span><span class="n">vertices</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Vertex: Kazan
Vertex: Samara
Vertex: Perm
Vertex: StPetersburg
Vertex: Orenburg
Vertex: Rostov
Vertex: Moscow
Vertex: Saratov
Vertex: Ufa
Vertex: Yekaterinburg
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">solver.algorithms</span> <span class="kn">import</span> <span class="n">get_minimum_spanning_tree</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">get_minimum_spanning_tree</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">key_attr</span><span class="o">=</span><span class="s">'cost'</span><span class="p">)</span>
<span class="n">total_cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">edge</span><span class="p">.</span><span class="n">cost</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">.</span><span class="n">edges</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">edge</span><span class="p">.</span><span class="n">cost</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Edge: Ufa-&gt;Yekaterinburg 125000
Edge: Perm-&gt;StPetersburg 185000
Edge: Orenburg-&gt;Ufa 75000
Edge: Kazan-&gt;Samara 95000
Edge: Saratov-&gt;Moscow 140000
Edge: Yekaterinburg-&gt;Perm 85000
Edge: Samara-&gt;Saratov 100000
Edge: Orenburg-&gt;Rostov 120000
Edge: Saratov-&gt;Orenburg 95000
</code></pre></div></div>

<p>The Minimum Spanning Tree is shown below:</p>

<p><img src="../assets/files/images/spanning_tree_solution.png" width="600" length="600" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">total_cost</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1020000
</code></pre></div></div>

<h3 id="the-bip-cutset-formulation-of-mst">The BIP (cutset) formulation of MST</h3>

<p>Given the undirected graph, we can formulate the MST problem as a BIP. Shown below is one of multiple ways this can be done. This particular formulation is called the <em>cutset</em> formulation.</p>

<p>Parameters:</p>

\[c_{i, j}:= \text{ Cost associated with edge (i, j)}\]

<p>Variables:</p>

\[y_{i, j}:= \begin{cases}1 \text{ if edge (i, j) is chosen}\\0 \text{ otherwise}\end{cases}\]

<p>Objective:</p>

\[\text{Minimize }\sum_{i=1}^n \sum_{j = 1}^n c_{i,j} y_{i, j}\]

<p>Constraints:</p>

\[y_{i, j} = y_{j, i}\quad , \forall\ i, j\qquad \text{(Symmetry)}\]

\[\sum_{i=1}^n \sum_{j=1}^n y_{i, j} = 2 (n - 1)\qquad \text{(Tree)}\]

\[\sum_{(i, j)\  \in \ \delta(S)} y_{j, i} \ge 1 \quad , \forall\ S \subset V, S\ne V, S \ne \emptyset \quad \text{(Connectivity)}\]

<p>where \(V\) the set of vertices of the graph, and \(\delta(S)\) is the <em>cutset</em> of S containing edges that have one end in \(S\) and the other in \(V \backslash S\).</p>

<p>It is worth noting that the number of connectivity constraints equals the total number of non-empty, proper subsets \(S\) of \(V\). This number is precisely \(2^n - 2\) where \(n = \mid V \mid\). As we can see, <strong>the number of connectivity constraints grows exponentially with the number of vertices in the graph</strong>. This makes the BIP formulation of the MST practically intractable and we will not go any further with this approach.</p>

<h1 id="references">References</h1>

<p>Notebook available at:</p>

<p>https://github.com/ayusbhar2/optimization/blob/main/applications/network_optimization/network_optimization.ipynb</p>

  
</article>



<footer>
  <div>Algebra, Geometry and Applications of Optimization</div>
  <nav><a href="mailto:ayush.bharadwaj@gmail.com" ><svg aria-label="Mail" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#envelope"></use></svg></a><a href="https://github.com/ayusbhar2" ><svg aria-label="Github" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#github"></use></svg></a><a href="https://www.linkedin.com/in/ayushbharadwaj/" ><svg aria-label="LinkedIn" class="icon"><use xlink:href="/assets/fontawesome/icons.svg#linkedin"></use></svg></a></nav>

</footer>


</html>
